name: Build PS4 Project

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      PS4SDK: ${{ github.workspace }}/SDK

    steps:
    - name: 📥 Repository auschecken
      uses: actions/checkout@v3

    - name: 🛠️ Abhängigkeiten installieren
      run: |
        sudo apt-get update
        sudo apt-get install -y make clang gcc g++ llvm binutils
        sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
        sudo apt-get update
        sudo apt-get install -y g++-7 gcc-7 aptitude golang

    - name: 🔧 Environment setzen
      run: |
        echo "PS4SDK=${{ github.workspace }}/SDK" >> $GITHUB_ENV

    - name: 🔨 libPS4 bauen
      run: |
        cd $PS4SDK/libPS4
        make

    # Falls du libusbfatfs brauchst, diesen Block aktivieren:
    # - name: 🔨 libusbfatfs bauen
    #   run: |
    #     cd $PS4SDK/libusbfatfs
    #     make

    - name: 🚀 Payload bauen
      run: |
        cd $GITHUB_WORKSPACE/gtaPayload
        make clean && make
        cd ..
        make clean && make
